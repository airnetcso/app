<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Membaca Korea ðŸ‡°ðŸ‡·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f8ff;
            text-align: center;
            padding: 50px;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        h1 { color: #ff4500; margin-bottom: 10px; }
        h2 { color: #333; }

        input, button {
            padding: 12px 20px;
            margin: 10px;
            font-size: 18px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        button {
            cursor: pointer;
            border: none;
            color: white;
            transition: 0.3s;
        }

        button:hover { opacity: 0.9; }

        #login-btn { background: #4285f4; }
        .level-btn { background: #9c27b0; width: 200px; }
        #start-btn { background: #ff9800; }
        #mic-btn { background: #ff5722; }
        #next-btn { background: #4caf50; }
        #logout-btn { background: #f44336; font-size: 14px; padding: 8px 16px; }

        .text {
            font-size: 48px;
            margin: 40px;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 10px;
            min-height: 100px;
        }

        .correct { background: #90ee90; color: green; border-color: green; }

        #status { min-height: 30px; margin-top: 20px; font-weight: bold; }
        .hint { font-size: 18px; color: #555; margin: 20px 0; }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Halaman Login -->
        <div id="login-page">
            <h1>Selamat Datang! ðŸ‡°ðŸ‡·</h1>
            <p>Masuk dulu ya biar bisa latihan membaca Hangul</p>
            <input type="text" id="username" placeholder="Username" required><br>
            <input type="password" id="password" placeholder="Password" required><br>
            <button id="login-btn">Login</button>
            <p style="color: #666; font-size: 14px;">Hint: username apa aja, password: <strong>korea123</strong></p>
        </div>

        <!-- Pilih Level -->
        <div id="level-page" class="hidden">
            <h1>Halo, <span id="welcome-user"></span>! ðŸ‘‹</h1>
            <h2>Pilih Level Latihan</h2>
            <button class="level-btn" data-level="pemula">Pemula</button><br>
            <button class="level-btn" data-level="sedang">Sedang</button><br>
            <button class="level-btn" data-level="mahir">Mahir</button><br><br>
            <button id="logout-btn">Logout</button>
        </div>

        <!-- Halaman Latihan -->
        <div id="practice-page" class="hidden">
            <h1>Latihan Membaca Hangul - <span id="current-level"></span></h1>
            <p>Baca teks di bawah ini keras-keras, lalu klik mic untuk cek!</p>
            
            <div id="text-display" class="text">Pilih level dulu ya!</div>
            <div id="hint" class="hint"></div>
            
            <button id="start-btn">Mulai Latihan</button>
            <button id="mic-btn" disabled>ðŸŽ¤ Baca Sekarang</button>
            <button id="next-btn" disabled>Selanjutnya</button>
            <br><br>
            <button id="back-btn">Kembali ke Pilih Level</button>
            
            <p id="status"></p>
        </div>
    </div>

    <script>
        // Data latihan berdasarkan level
        const dataLatihan = {
            pemula: [
                {text: "ì•ˆë…•", hint: "Annyeong (Halo santai)"},
                {text: "ê°ì‚¬", hint: "Gamsa (Terima kasih santai)"},
                {text: "ì‚¬ëž‘í•´", hint: "Saranghae (Aku cinta kamu santai)"},
                {text: "ë°¥", hint: "Bab (Nasi/Makan)"},
                {text: "ë¬¼", hint: "Mul (Air)"},
                {text: "ì¢‹ì•„", hint: "Joa (Suka)"},
                {text: "ë¯¸ì•ˆ", hint: "Mian (Maaf santai)"}
            ],
            sedang: [
                {text: "ì•ˆë…•í•˜ì„¸ìš”", hint: "Annyeonghaseyo (Halo formal)"},
                {text: "ê°ì‚¬í•©ë‹ˆë‹¤", hint: "Gamsahamnida (Terima kasih formal)"},
                {text: "ì‚¬ëž‘í•´ìš”", hint: "Saranghaeyo (Aku cinta kamu formal)"},
                {text: "ë°¥ ë¨¹ì—ˆì–´ìš”?", hint: "Bab meogeosseoyo? (Sudah makan?)"},
                {text: "ì´ë¦„ì´ ë­ì˜ˆìš”?", hint: "Ireumi mwoyeyo? (Siapa nama kamu?)"},
                {text: "ë°˜ê°‘ìŠµë‹ˆë‹¤", hint: "Bangapseumnida (Senang bertemu)"},
                {text: "ì–´ë”” ì‚´ì•„ìš”?", hint: "Eodi sarayo? (Tinggal di mana?)"}
            ],
            mahir: [
                {text: "ì˜¤ëŠ˜ ë‚ ì”¨ê°€ ì •ë§ ì¢‹ë„¤ìš”", hint: "Oneul nalssiga jeongmal jotneyo"},
                {text: "ì €ëŠ” ë§¤ì¼ í•œêµ­ì–´ë¥¼ ê³µë¶€í•´ìš”", hint: "Jeoneun maeil hangugeoreul gongbuhaeyo"},
                {text: "í•œêµ­ ë“œë¼ë§ˆë¥¼ ì¢‹ì•„í•˜ì„¸ìš”?", hint: "Hanguk deuramareul joahaseyo?"},
                {text: "ì£¼ë§ì— ë­ í•  ê±°ì˜ˆìš”?", hint: "Jumare mwo hal geoyeyo?"},
                {text: "ì´ ìŒì‹ì€ ì •ë§ ë§›ìžˆì–´ìš”", hint: "I eumsigeun jeongmal masisseoyo"},
                {text: "ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”", hint: "Daeume tto mannayo"}
            ]
        };

        // Element
        const loginPage = document.getElementById('login-page');
        const levelPage = document.getElementById('level-page');
        const practicePage = document.getElementById('practice-page');
        const welcomeUser = document.getElementById('welcome-user');
        const currentLevelDisplay = document.getElementById('current-level');

        // Login
        document.getElementById('login-btn').addEventListener('click', () => {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (username && password === 'korea123') {
                welcomeUser.textContent = username;
                loginPage.classList.add('hidden');
                levelPage.classList.remove('hidden');
            } else {
                alert('Password salah bro! Coba: korea123');
            }
        });

        // Pilih Level
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const level = btn.dataset.level;
                currentLevel = level;
                currentLevelDisplay.textContent = level.charAt(0).toUpperCase() + level.slice(1);
                exercises = dataLatihan[level];
                currentIndex = 0;

                levelPage.classList.add('hidden');
                practicePage.classList.remove('hidden');
                resetPractice();
            });
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            levelPage.classList.add('hidden');
            loginPage.classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // Kembali ke level
        document.getElementById('back-btn').addEventListener('click', () => {
            practicePage.classList.add('hidden');
            levelPage.classList.remove('hidden');
        });

        // Latihan variables
        let exercises = [];
        let currentIndex = 0;
        let currentLevel = '';
        let recognition;

        const textDisplay = document.getElementById('text-display');
        const hintDisplay = document.getElementById('hint');
        const startBtn = document.getElementById('start-btn');
        const micBtn = document.getElementById('mic-btn');
        const nextBtn = document.getElementById('next-btn');
        const status = document.getElementById('status');

        function resetPractice() {
            textDisplay.textContent = 'Klik "Mulai Latihan" untuk memulai';
            hintDisplay.textContent = '';
            status.textContent = '';
            startBtn.disabled = false;
            micBtn.disabled = true;
            nextBtn.disabled = true;
            textDisplay.classList.remove('correct');
        }

        startBtn.addEventListener('click', () => {
            currentIndex = 0;
            loadExercise();
            startBtn.disabled = true;
            micBtn.disabled = false;
        });

        nextBtn.addEventListener('click', () => {
            currentIndex++;
            if (currentIndex >= exercises.length) {
                textDisplay.textContent = 'Selamat! Kamu sudah selesai level ini ðŸŽ‰';
                hintDisplay.textContent = '';
                textDisplay.classList.remove('correct');
                micBtn.disabled = true;
                nextBtn.disabled = true;
                status.textContent = 'Kerja bagus bro! Pilih level lain atau logout.';
                return;
            }
            loadExercise();
        });

        function loadExercise() {
            textDisplay.textContent = exercises[currentIndex].text;
            hintDisplay.textContent = `Hint: ${exercises[currentIndex].hint}`;
            textDisplay.classList.remove('correct');
            status.textContent = '';
            nextBtn.disabled = true;
        }

        // Speech Recognition
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'ko-KR';
            recognition.continuous = false;

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                const target = exercises[currentIndex].text;

                const normTranscript = transcript.replace(/\s/g, '').toLowerCase();
                const normTarget = target.replace(/\s/g, '').toLowerCase();

                if (normTranscript.includes(normTarget) || levenshteinDistance(normTranscript, normTarget) <= 4) {
                    textDisplay.classList.add('correct');
                    status.textContent = 'Betul banget! Mantap ðŸ”¥';
                    status.style.color = 'green';
                    nextBtn.disabled = false;
                } else {
                    status.textContent = `Kurang tepat. Kamu bilang: "${transcript}"`;
                    status.style.color = 'red';
                }
            };

            recognition.onerror = () => {
                status.textContent = 'Mic error, coba lagi ya!';
                status.style.color = 'red';
                micBtn.textContent = 'ðŸŽ¤ Baca Sekarang';
            };

            recognition.onend = () => {
                micBtn.textContent = 'ðŸŽ¤ Baca Sekarang';
            };
        } else {
            status.textContent = 'Browser tidak support mic. Pakai Chrome ya bro!';
            status.style.color = 'red';
            micBtn.disabled = true;
        }

        micBtn.addEventListener('click', () => {
            if (recognition) {
                recognition.start();
                micBtn.textContent = 'ðŸŽ¤ Sedang Mendengar...';
                status.textContent = 'Baca sekarang!';
                status.style.color = '#ff9800';
            }
        });

        function levenshteinDistance(a, b) {
            const matrix = Array(b.length + 1).fill().map(() => Array(a.length + 1).fill(0));
            for (let i = 0; i <= a.length; i++) matrix[0][i] = i;
            for (let j = 0; j <= b.length; j++) matrix[j][0] = j;
            for (let j = 1; j <= b.length; j++) {
                for (let i = 1; i <= a.length; i++) {
                    matrix[j][i] = a[i-1] === b[j-1] ? matrix[j-1][i-1] : Math.min(
                        matrix[j-1][i-1] + 1,
                        matrix[j][i-1] + 1,
                        matrix[j-1][i] + 1
                    );
                }
            }
            return matrix[b.length][a.length];
        }
    </script>
</body>
</html>