<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Baca Korea üá∞üá∑</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f8ff; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 100%; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        h1 { color: #ff4500; font-size: 28px; margin: 10px 0; }
        input, button { width: 90%; padding: 15px; margin: 15px auto; font-size: 20px; border-radius: 10px; border: 1px solid #ccc; }
        button { background: #4285f4; color: white; border: none; cursor: pointer; }
        button:hover { opacity: 0.9; }
        .level-btn { background: #9c27b0; }
        #start-btn { background: #ff9800; }
        #mic-btn { background: #ff5722; font-size: 24px; padding: 20px; }
        #next-btn { background: #4caf50; }
        #back-btn, #guide-btn, #logout-btn { background: #666; font-size: 16px; }
        .text-display { font-size: 48px; margin: 30px auto; padding: 20px; min-height: 120px; word-wrap: break-word; line-height: 1.4; }
        .syllable { display: inline-block; padding: 8px 12px; margin: 6px; border-radius: 10px; background: #eee; transition: all 0.4s; }
        .correct { background: #90ee90 !important; color: green; }
        .incorrect { background: #ffcccb !important; color: red; }
        #status { font-size: 20px; font-weight: bold; min-height: 50px; margin: 20px; }
        .hint { font-size: 20px; color: #555; margin: 20px; }
        .hidden { display: none; }
        .guide-content { text-align: left; font-size: 18px; line-height: 1.6; padding: 20px; background: #f9f9f9; border-radius: 10px; margin: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login -->
        <div id="login-page">
            <h1>Selamat Datang! üá∞üá∑</h1>
            <p>Masuk dulu ya</p>
            <input type="text" id="username" placeholder="Username"><br>
            <input type="password" id="password" placeholder="Password"><br>
            <button id="login-btn">Login</button>
            <p style="font-size:14px;">Password: <strong>korea123</strong></p>
        </div>

        <!-- Level -->
        <div id="level-page" class="hidden">
            <h1>Halo, <span id="welcome-user"></span>! üëã</h1>
            <h2>Pilih Level</h2>
            <button class="level-btn" data-level="pemula">Pemula</button>
            <button class="level-btn" data-level="sedang">Sedang</button>
            <button class="level-btn" data-level="mahir">Mahir</button>
            <button id="guide-btn">Panduan Cara Baca Hangul</button>
            <button id="logout-btn">Logout</button>
        </div>

        <!-- Guide -->
        <div id="guide-page" class="hidden">
            <h1>Panduan Cara Baca Hangul üìñ</h1>
            <div class="guide-content">
                <p><strong>Aturan Dasar:</strong></p>
                <ul>
                    <li>Baca kiri ‚Üí kanan, atas ‚Üí bawah tiap blok syllable.</li>
                    <li>Consonant + vowel = dasar, batchim (bawah) pindah ke syllable berikut kalau mulai vowel.</li>
                    <li>Aspirated („Öã,„Öå,„Öç,„Öä): napas kuat.</li>
                    <li>Tense („Ñ≤,„Ñ∏,„ÖÉ,„ÖÜ,„Öâ): tegang & pendek.</li>
                    <li>„Ñπ: L/R ringan.</li>
                    <li>„Öé sering lembut/hilang di akhir.</li>
                </ul>
                <p><strong>Tips:</strong> Baca pelan per blok dulu, dengar native (YouTube/TTMIK). Fighting! üí™</p>
            </div>
            <button id="back-from-guide">Kembali</button>
        </div>

        <!-- Practice -->
        <div id="practice-page" class="hidden">
            <h1>Latihan - <span id="current-level"></span></h1>
            <div id="text-display" class="text-display"></div>
            <div id="hint" class="hint"></div>
            <button id="start-btn">Mulai Latihan</button>
            <button id="mic-btn" disabled>üé§ Baca Sekarang</button>
            <button id="next-btn" disabled>Selanjutnya</button>
            <button id="back-btn">Kembali ke Level</button>
            <button id="guide-btn2">Panduan Cara Baca</button>
            <p id="status"></p>
        </div>
    </div>

    <script>
        const dataLatihan = {
            pemula: [
                {text: "ÏïàÎÖï", syllables: ["Ïïà","ÎÖï"], hint: "Annyeong (Halo santai)"},
                {text: "Í∞êÏÇ¨", syllables: ["Í∞ê","ÏÇ¨"], hint: "Gamsa (Terima kasih santai)"},
                {text: "Î∞•", syllables: ["Î∞•"], hint: "Bab (Makan)"}
            ],
            sedang: [
                {text: "ÏïàÎÖïÌïòÏÑ∏Ïöî", syllables: ["Ïïà","ÎÖï","Ìïò","ÏÑ∏","Ïöî"], hint: "Annyeonghaseyo"},
                {text: "Í∞êÏÇ¨Ìï©ÎãàÎã§", syllables: ["Í∞ê","ÏÇ¨","Ìï©","Îãà","Îã§"], hint: "Gamsahamnida"},
                {text: "Î∞• Î®πÏóàÏñ¥Ïöî?", syllables: ["Î∞•","Î®π","Ïóà","Ïñ¥","Ïöî?"], hint: "Bab meogeosseoyo?"}
            ],
            mahir: [
                {text: "Ïò§Îäò ÎÇ†Ïî®Í∞Ä Ï†ïÎßê Ï¢ãÎÑ§Ïöî", syllables: ["Ïò§","Îäò","ÎÇ†","Ïî®","Í∞Ä","Ï†ï","Îßê","Ï¢ã","ÎÑ§","Ïöî"], hint: "Oneul nalssiga jeongmal jotneyo"},
                {text: "Ï†ÄÎäî Îß§Ïùº ÌïúÍµ≠Ïñ¥Î•º Í≥µÎ∂ÄÌï¥Ïöî", syllables: ["Ï†Ä","Îäî","Îß§","Ïùº","Ìïú","Íµ≠","Ïñ¥","Î•º","Í≥µ","Î∂Ä","Ìï¥","Ïöî"], hint: "Jeoneun maeil hangugeoreul gongbuhaeyo"}
            ]
        };

        const pages = {
            login: document.getElementById('login-page'),
            level: document.getElementById('level-page'),
            guide: document.getElementById('guide-page'),
            practice: document.getElementById('practice-page')
        };
        const welcomeUser = document.getElementById('welcome-user');
        const currentLevelDisplay = document.getElementById('current-level');
        const textDisplay = document.getElementById('text-display');
        const hintDisplay = document.getElementById('hint');
        const status = document.getElementById('status');

        // Navigation (sama seperti sebelumnya)
        document.getElementById('login-btn').onclick = () => {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            if (username && password === 'korea123') {
                welcomeUser.textContent = username;
                pages.login.classList.add('hidden');
                pages.level.classList.remove('hidden');
            } else alert('Password salah! Coba korea123');
        };

        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.onclick = () => {
                currentLevel = btn.dataset.level;
                currentLevelDisplay.textContent = currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
                exercises = dataLatihan[currentLevel];
                currentIndex = 0;
                pages.level.classList.add('hidden');
                pages.practice.classList.remove('hidden');
                resetPractice();
            };
        });

        document.getElementById('guide-btn').onclick = document.getElementById('guide-btn2').onclick = () => {
            pages.level.classList.add('hidden');
            pages.practice.classList.add('hidden');
            pages.guide.classList.remove('hidden');
        };

        document.getElementById('back-from-guide').onclick = () => {
            pages.guide.classList.add('hidden');
            currentLevel ? pages.practice.classList.remove('hidden') : pages.level.classList.remove('hidden');
        };

        document.getElementById('back-btn').onclick = () => {
            pages.practice.classList.add('hidden');
            pages.level.classList.remove('hidden');
        };

        document.getElementById('logout-btn').onclick = () => {
            pages.level.classList.add('hidden');
            pages.login.classList.remove('hidden');
        };

        // Practice
        let exercises = [], currentIndex = 0, currentLevel = '';
        let recognition, currentSyllables = [], matchedCount = 0;

        function resetPractice() {
            textDisplay.innerHTML = '<div style="color:#999;font-size:32px;">Klik Mulai Latihan</div>';
            hintDisplay.textContent = '';
            status.textContent = '';
            document.getElementById('start-btn').disabled = false;
            document.getElementById('mic-btn').disabled = true;
            document.getElementById('next-btn').disabled = true;
        }

        document.getElementById('start-btn').onclick = () => {
            currentIndex = 0;
            loadExercise();
            document.getElementById('start-btn').disabled = true;
            document.getElementById('mic-btn').disabled = false;
        };

        document.getElementById('next-btn').onclick = () => {
            currentIndex++;
            if (currentIndex >= exercises.length) {
                textDisplay.innerHTML = '<div style="color:green;font-size:40px;">Selesai level ini! üéâ</div>';
                hintDisplay.textContent = '';
                document.getElementById('mic-btn').disabled = true;
                document.getElementById('next-btn').disabled = true;
                return;
            }
            matchedCount = 0;
            loadExercise();
        };

        function loadExercise() {
            const ex = exercises[currentIndex];
            currentSyllables = ex.syllables;
            textDisplay.innerHTML = '';
            ex.syllables.forEach(syl => {
                const span = document.createElement('span');
                span.className = 'syllable';
                span.textContent = syl;
                span.dataset.norm = syl.toLowerCase();
                textDisplay.appendChild(span);
            });
            hintDisplay.textContent = `Hint: ${ex.hint}`;
            status.textContent = '';
            document.getElementById('next-btn').disabled = true;
            matchedCount = 0;
        }

        // Speech Recognition - Real-time progressive matching
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'ko-KR';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                const spoken = transcript.trim().toLowerCase().replace(/\s/g, '');

                const spans = textDisplay.querySelectorAll('.syllable');
                let cumulative = '';
                let newMatched = 0;

                spans.forEach((span, idx) => {
                    span.classList.remove('correct', 'incorrect');
                    const target = span.dataset.norm;
                    cumulative += target;

                    // Match prefix yang sudah terdengar
                    if (spoken.startsWith(cumulative.slice(0, cumulative.length - target.length + Math.floor(target.length / 2)))) {
                        // Toleransi tinggi: kalau spoken sudah cover sebagian besar cumulative
                        newMatched = idx + 1;
                    }
                });

                // Highlight correct sampai matched
                for (let i = 0; i < newMatched; i++) {
                    spans[i].classList.add('correct');
                }

                // Kalau ada yang kelihatan salah (spoken panjang tapi nggak match)
                if (spoken.length > cumulative.length + 5) {
                    for (let i = newMatched; i < spans.length; i++) {
                        spans[i].classList.add('incorrect');
                    }
                }

                matchedCount = newMatched;

                if (matchedCount === currentSyllables.length) {
                    status.textContent = 'Betul semua! Mantap üî•';
                    status.style.color = 'green';
                    document.getElementById('next-btn').disabled = false;
                } else {
                    status.textContent = 'Sedang mendengar... teruskan baca!';
                    status.style.color = '#ff9800';
                }
            };

            recognition.onerror = () => {
                status.textContent = 'Mic error, coba lagi!';
                status.style.color = 'red';
            };

            recognition.onend = () => {
                document.getElementById('mic-btn').textContent = 'üé§ Baca Sekarang';
            };
        } else {
            alert('Browser tidak support speech recognition. Pakai Chrome ya!');
        }

        document.getElementById('mic-btn').onclick = () => {
            recognition.start();
            document.getElementById('mic-btn').textContent = 'üé§ Sedang Mendengar... (baca terus)';
            status.textContent = 'Mulai baca kalimatnya pelan-pelan!';
            status.style.color = '#ff9800';
        };
    </script>
</body>
</html>
